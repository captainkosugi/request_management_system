# Тестовое задание: Управление заявками

## Задачи:
1. Спроектировать модель данных.
2. Разработать SQL-скрипты для создания таблиц и наполнения их тестовыми данными.
3. Обработать реестр платежей из CSV-файла.
4. Написать аналитические SQL-запросы.
5. Предоставить описание процессов.


## Модель данных

Модель данных включает следующие сущности:

1. **`person`**:
   - Хранит информацию о физических лицах.
   - Поля: `id`, `name`, `experience`, `has_privileges`, `status`.

2. **`service`**:
   - Хранит информацию об услугах.
   - Поля: `id`, `name`, `description`, `is_available`.

3. **`requests`**:
   - Хранит информацию о заявках.
   - Поля: `id`, `person_id`, `service_id`, `status`, `created_at`, `approved_at`.

4. **`payments`**:
   - Хранит информацию о платежах.
   - Поля: `id`, `request_id`, `amount`, `payment_date`, `purpose`.
  

## Связи между таблицами:
- `requests.person_id` → `person.id`
- `requests.service_id` → `service.id`
- `payments.request_id` → `requests.id`

## Как использовать

### 1. Создайте базу данных
```sql
CREATE DATABASE db_name;
```
### 2. Загрузите структуру таблиц
```bash
psql -U postgres -d db_name -f schema.sql
```
### 3. Добавьте тестовые данные
```bash
psql -U postgres -d db_name -f test_data.sql
```
### 4. Загрузите данные из CSV
```bash
psql -U postgres -d db_name -f load_payments.sql
```
### 5. Выполните аналитические запросы
```bash
psql -U postgres -d db_name -f queries.sql
```

## Описание процессов
1. Создание заявки
- ФЛ выбирает услугу. Создается запись в таблице requests со статусом "новая".
2. Одобрение заявки
- Администратор проверяет заявку. Если заявка одобрена, обновляется поле status на "одобрена" и заполняется поле approved_at.
3. Оплата
- ФЛ вносит предоплату. После оказания услуги вносится окончательная оплата. Платежи сохраняются в таблице payments.
